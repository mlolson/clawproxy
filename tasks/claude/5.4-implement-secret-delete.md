# Task 5.4: Implement `clawproxy secret delete`

**Assignee:** Claude
**Dependencies:** 5.2
**Status:** Open

## Description

Implement the command to delete stored secrets.

## Acceptance Criteria

- [ ] Delete secret file from secrets directory
- [ ] Confirm before deletion (unless --force)
- [ ] Error if secret doesn't exist
- [ ] Print confirmation

## Implementation

```rust
async fn cmd_secret_delete(name: &str, force: bool) -> Result<()> {
    let config = Config::load(None)?;
    let secrets_dir = config.secrets_dir();
    let secret_path = secrets_dir.join(name);

    if !secret_path.exists() {
        anyhow::bail!("Secret '{}' not found", name);
    }

    // Confirm unless forced
    if !force {
        print!("Delete secret '{}'? [y/N] ", name);
        io::stdout().flush()?;

        let mut input = String::new();
        io::stdin().read_line(&mut input)?;

        if !input.trim().eq_ignore_ascii_case("y") {
            println!("Cancelled");
            return Ok(());
        }
    }

    // Check if any services use this secret
    let config = Config::load(None)?;
    let used_by: Vec<_> = config.services
        .iter()
        .filter(|(_, s)| s.secret == name)
        .map(|(n, _)| n.as_str())
        .collect();

    if !used_by.is_empty() && !force {
        println!("Warning: Secret '{}' is used by services: {}",
            name, used_by.join(", "));
        print!("Delete anyway? [y/N] ");
        io::stdout().flush()?;

        let mut input = String::new();
        io::stdin().read_line(&mut input)?;

        if !input.trim().eq_ignore_ascii_case("y") {
            println!("Cancelled");
            return Ok(());
        }
    }

    fs::remove_file(&secret_path)?;
    println!("Deleted secret '{}'", name);

    Ok(())
}
```

## CLI Definition

```rust
#[derive(Subcommand)]
enum SecretCommands {
    // ...
    Delete {
        name: String,
        #[arg(short, long)]
        force: bool,
    },
}
```

## Usage

```bash
# Interactive
clawproxy secret delete openai
Delete secret 'openai'? [y/N] y
Deleted secret 'openai'

# Forced
clawproxy secret delete openai --force
Deleted secret 'openai'
```

## Notes

- Warn if secret is referenced by services
- Consider secure deletion (overwrite before delete) for future

## validation

mattolson@Matts-MacBook-Pro clawproxy % cargo run --bin clawproxy secret list                         
   Compiling clawproxy v0.1.0 (/Users/mattolson/code/clawproxy)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.25s
     Running `target/debug/clawproxy secret list`
Secrets:
NAME         USED BY         
test                         
secret.txt                   
anthropic    anthropic       
openai       openai          
mattolson@Matts-MacBook-Pro clawproxy % cargo run --bin clawproxy secret delete test     
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.07s
     Running `target/debug/clawproxy secret delete test`
Delete secret 'test'? [y/N] y
Deleted secret 'test'
mattolson@Matts-MacBook-Pro clawproxy % cargo run --bin clawproxy secret list       
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.06s
     Running `target/debug/clawproxy secret list`
Secrets:
NAME         USED BY         
secret.txt                   
anthropic    anthropic       
openai       openai          
mattolson@Matts-MacBook-Pro clawproxy % 