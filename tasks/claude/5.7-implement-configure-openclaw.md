# Task 5.7: Implement `clawproxy configure-openclaw`

**Assignee:** Claude
**Dependencies:** 5.1, 5.2, 3.4
**Status:** Open

## Description

Implement automated OpenClaw integration that modifies configs and daemon service.

## Acceptance Criteria

- [ ] Locate and modify OpenClaw config file
- [ ] Migrate API keys to clawproxy secrets (with prompts)
- [ ] Update baseUrl and apiKey for each provider
- [ ] Modify daemon service file to use clawproxy-run
- [ ] Backup all modified files
- [ ] Support --dry-run, --revert flags
- [ ] Reload daemon service

## Implementation

See IMPLEMENTATION_PLAN.md Task 5.7 for detailed steps.

```rust
async fn cmd_configure_openclaw(dry_run: bool, revert: bool) -> Result<()> {
    if revert {
        return revert_openclaw_config().await;
    }

    // Part A: OpenClaw Configuration
    let openclaw_config_path = dirs::home_dir()
        .ok_or_else(|| anyhow!("Could not find home directory"))?
        .join(".openclaw/openclaw.json");

    if !openclaw_config_path.exists() {
        anyhow::bail!(
            "OpenClaw config not found at {}\n\
             Run 'openclaw onboard' first",
            openclaw_config_path.display()
        );
    }

    // Read and parse config
    let config_content = fs::read_to_string(&openclaw_config_path)?;
    let mut config: serde_json::Value = serde_json::from_str(&config_content)?;

    // Process each provider
    if let Some(providers) = config
        .get_mut("models")
        .and_then(|m| m.get_mut("providers"))
        .and_then(|p| p.as_object_mut())
    {
        for (provider_name, provider_config) in providers.iter_mut() {
            process_provider(provider_name, provider_config, dry_run).await?;
        }
    }

    if dry_run {
        println!("\n[Dry run] Would modify:");
        println!("  - {}", openclaw_config_path.display());
        // ... show daemon file
        return Ok(());
    }

    // Backup and write config
    backup_file(&openclaw_config_path)?;
    fs::write(&openclaw_config_path, serde_json::to_string_pretty(&config)?)?;

    // Part B: Daemon Service
    modify_daemon_service()?;

    println!("\nOpenClaw configured successfully!");
    println!("\nBackups created:");
    println!("  - {}.pre-clawproxy", openclaw_config_path.display());
    // ...

    Ok(())
}
```

## File Locations

| File | macOS | Linux |
|------|-------|-------|
| OpenClaw config | ~/.openclaw/openclaw.json | ~/.openclaw/openclaw.json |
| OpenClaw daemon | ~/Library/LaunchAgents/ai.openclaw.gateway.plist | ~/.config/systemd/user/openclaw-gateway.service |

## Flags

- `--dry-run`: Show changes without modifying
- `--revert`: Restore from .pre-clawproxy backups
- `--skip-config`: Only modify daemon
- `--skip-daemon`: Only modify config

## Notes

- Always backup before modifying
- Prompt user before migrating keys
- Warn about oauth.json if it contains keys
