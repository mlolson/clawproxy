# Task 5.1: Implement `clawproxy init`

**Assignee:** Claude
**Dependencies:** 2.1
**Status:** Open

## Description

Implement the init command to set up clawproxy configuration and service files.

## Acceptance Criteria

- [ ] Create `~./clawproxy/` directory
- [ ] Create `secrets/` subdirectory with mode 700
- [ ] Write default `config.yaml`
- [ ] Create OS-specific service files (plist/systemd)
- [ ] Register service (but don't start)
- [ ] Print next steps

## Implementation

```rust
// In CLI command handler

async fn cmd_init() -> Result<()> {
    let config_dir = dirs::config_dir()
        .ok_or_else(|| anyhow!("Could not find config directory"))?
        .join("clawproxy");

    // Create directories
    fs::create_dir_all(&config_dir)?;

    let secrets_dir = config_dir.join("secrets");
    fs::create_dir_all(&secrets_dir)?;

    // Set secrets dir permissions to 700
    #[cfg(unix)]
    {
        use std::os::unix::fs::PermissionsExt;
        fs::set_permissions(&secrets_dir, fs::Permissions::from_mode(0o700))?;
    }

    // Write default config
    let config_path = config_dir.join("config.yaml");
    if !config_path.exists() {
        let default_config = Config::default();
        let yaml = serde_yaml::to_string(&default_config)?;
        fs::write(&config_path, yaml)?;
        tracing::info!(path = %config_path.display(), "Created config file");
    }

    // Create service file
    create_service_file()?;

    println!("Initialized clawproxy at {}", config_dir.display());
    println!();
    println!("Next steps:");
    println!("  1. Add your API keys:");
    println!("     clawproxy secret set openai");
    println!("     clawproxy secret set anthropic");
    println!();
    println!("  2. Start the proxy:");
    println!("     clawproxy start");

    Ok(())
}
```

## Service Files

### macOS (~/Library/LaunchAgents/ai.clawproxy.plist)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "...">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>ai.clawproxy</string>
    <key>ProgramArguments</key>
    <array>
        <string>/usr/local/bin/clawproxy</string>
        <string>start</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
</dict>
</plist>
```

### Linux (~/.config/systemd/user/clawproxy.service)

```ini
[Unit]
Description=ClawProxy credential injection proxy

[Service]
ExecStart=/usr/local/bin/clawproxy start
Restart=on-failure
RestartSec=5

[Install]
WantedBy=default.target
```

## Notes

- Detect clawproxy binary location for service file
- Don't overwrite existing config
- Consider `--force` flag to overwrite
