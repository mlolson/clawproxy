# Task 5.3: Implement `clawproxy secret list`

**Assignee:** Human
**Dependencies:** 5.2
**Status:** Open

## Why This Task is Assigned to Human

This is a simpler CLI task that's a good starting point. It helps you understand the secrets storage format.

## Description

Implement the command to list all stored secrets with masked previews.

## Acceptance Criteria

- [ ] List all files in secrets directory
- [ ] Show masked preview of each secret
- [ ] Show which services use each secret
- [ ] Handle empty secrets directory
- [ ] Handle missing secrets directory

## Expected Output

```
$ clawproxy secret list
NAME        PREVIEW         USED BY
openai      sk-pr...7x2s    openai
anthropic   sk-an...4f8j    anthropic
github      ghp_x...9k2m    (unused)

3 secrets stored
```

## Implementation Steps

1. **Load config to know which secrets are used by services**
```rust
let config = Config::load(None)?;
let secrets_dir = config.secrets_dir();
```

2. **Read secrets directory**
```rust
let entries = fs::read_dir(&secrets_dir)?;
```

3. **For each secret, get info**
```rust
struct SecretInfo {
    name: String,
    preview: String,
    used_by: Vec<String>,
}

fn get_secret_info(path: &Path, config: &Config) -> Result<SecretInfo> {
    let name = path.file_name()?.to_string_lossy().to_string();
    let content = fs::read_to_string(path)?;
    let preview = mask_secret(&content);

    let used_by: Vec<String> = config.services
        .iter()
        .filter(|(_, s)| s.secret == name)
        .map(|(n, _)| n.clone())
        .collect();

    Ok(SecretInfo { name, preview, used_by })
}
```

4. **Format output nicely**
```rust
fn mask_secret(secret: &str) -> String {
    let s = secret.trim();
    if s.len() <= 8 {
        "****".to_string()
    } else {
        format!("{}...{}", &s[..4], &s[s.len()-4..])
    }
}

fn print_secrets_table(secrets: &[SecretInfo]) {
    println!("{:<12} {:<16} {}", "NAME", "PREVIEW", "USED BY");
    for info in secrets {
        let used_by = if info.used_by.is_empty() {
            "(unused)".to_string()
        } else {
            info.used_by.join(", ")
        };
        println!("{:<12} {:<16} {}", info.name, info.preview, used_by);
    }
    println!();
    println!("{} secrets stored", secrets.len());
}
```

## Edge Cases

- Empty secrets directory: Print "No secrets stored"
- Secrets directory doesn't exist: Print helpful message
- Secret file is empty: Show "(empty)"
- Secret used by multiple services: Show all

## Testing

```bash
# Setup
clawproxy init
clawproxy secret set openai  # Enter: sk-proj-abc123xyz789
clawproxy secret set test    # Enter: test-key

# Test
clawproxy secret list
# Expected output showing both secrets

# Test empty
rm ~/.config/clawproxy/secrets/*
clawproxy secret list
# Expected: "No secrets stored"
```

## Hints

- Use `fs::read_dir()` to list directory contents
- Filter out hidden files (starting with `.`)
- Sort secrets alphabetically for consistent output
- Consider adding `--json` flag for machine-readable output
