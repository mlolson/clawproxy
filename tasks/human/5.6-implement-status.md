# Task 5.6: Implement `clawproxy status`

**Assignee:** Human
**Dependencies:** 5.5
**Status:** Open

## Why This Task is Assigned to Human

This is a simpler CLI task that helps you understand how to check system state and format output nicely.

## Description

Implement the status command to show proxy state and configuration.

## Acceptance Criteria

- [ ] Check if proxy is running
- [ ] Show listen address
- [ ] Show loaded services
- [ ] Test connectivity to proxy
- [ ] Show helpful info if not running

## Expected Output

```
$ clawproxy status
Status: Running
Listen: http://127.0.0.1:8080

Services:
  openai     -> https://api.openai.com
  anthropic  -> https://api.anthropic.com

Secrets:
  openai     ✓ configured
  anthropic  ✓ configured
```

Or if not running:

```
$ clawproxy status
Status: Not running

To start the proxy:
  clawproxy start
```

## Implementation Steps

1. **Check if proxy is running**

Option A: Try to connect
```rust
async fn is_proxy_running(host: &str, port: u16) -> bool {
    let addr = format!("{}:{}", host, port);
    tokio::net::TcpStream::connect(&addr)
        .await
        .is_ok()
}
```

Option B: Check for PID file (if implemented)
```rust
fn is_proxy_running() -> bool {
    let pid_file = dirs::runtime_dir()
        .unwrap_or_else(|| PathBuf::from("/tmp"))
        .join("clawproxy.pid");

    if let Ok(pid_str) = fs::read_to_string(&pid_file) {
        if let Ok(pid) = pid_str.trim().parse::<i32>() {
            // Check if process exists
            return nix::sys::signal::kill(
                nix::unistd::Pid::from_raw(pid),
                None
            ).is_ok();
        }
    }
    false
}
```

2. **Load and display config**
```rust
let config = Config::load(None)?;

println!("Listen: http://{}:{}", config.listen.host, config.listen.port);
println!();
println!("Services:");
for (name, service) in &config.services {
    println!("  {:<12} -> {}", name, service.upstream);
}
```

3. **Check secrets**
```rust
let secrets_dir = config.secrets_dir();
println!();
println!("Secrets:");
for (name, service) in &config.services {
    let secret_path = secrets_dir.join(&service.secret);
    let status = if secret_path.exists() {
        "✓ configured"
    } else {
        "✗ missing"
    };
    println!("  {:<12} {}", service.secret, status);
}
```

## Bonus Features

- Add `--json` flag for machine-readable output
- Show uptime if running
- Show request count (requires metrics)

## Testing

```bash
# When not running
clawproxy status
# Expected: "Status: Not running"

# Start proxy
clawproxy start &

# When running
clawproxy status
# Expected: Shows running status and config

# Stop proxy
kill %1
```

## Hints

- TCP connect is the simplest way to check if running
- Use colored output for status (green for running, red for not)
- Consider adding health endpoint to proxy for richer status
- Handle case where config doesn't exist yet
