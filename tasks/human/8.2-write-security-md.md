# Task 8.2: Write SECURITY.md

**Assignee:** Human
**Dependencies:** 3.5, 6.5
**Status:** Open

## Why This Task is Assigned to Human

Security documentation requires careful thought about threat models and honest assessment of limitations. This needs human judgment.

## Description

Write comprehensive security documentation for the project.

## Acceptance Criteria

- [ ] Document threat model
- [ ] Explain what is and isn't protected
- [ ] Document sandbox limitations
- [ ] Provide security recommendations
- [ ] Include responsible disclosure policy

## Document Structure

```markdown
# Security

## Threat Model

ClawProxy is designed to protect API credentials from AI agents that may be
subject to prompt injection attacks. It addresses the following threats:

### In Scope

- **Secret File Access**: Preventing the agent from reading credential files
- **Memory Exposure**: Keeping real credentials out of agent memory
- **Log Leakage**: Ensuring agent logs contain only placeholder tokens
- **Subprocess Attacks**: Preventing credential access via child processes

### Out of Scope

- **Resource Abuse**: An agent with proxy access can still make API calls
- **Malicious API Use**: The proxy forwards requests, it doesn't validate intent
- **Kernel Exploits**: A compromised kernel can bypass any userspace sandbox
- **Physical Access**: No protection against physical machine access

## Protection Matrix

| Attack Vector | Protected | Mechanism |
|--------------|-----------|-----------|
| `cat ~/.config/clawproxy/secrets/*` | ✓ | Sandbox blocks file read |
| Subprocess reads secrets | ✓ | Sandbox inherited by children |
| Agent logs Authorization header | ✓ | Only sees PROXY:xxx tokens |
| Prompt injection exfiltration | ✓ | Real keys never in agent memory |
| Agent makes expensive API calls | ✗ | Has proxy access |
| Agent sends malicious requests | ✗ | Proxy just forwards |
| Root/kernel exploit | ✗ | Userspace sandbox limitation |
| Agent disables sandbox | ✗ | If agent can modify its own launch |

## Sandbox Limitations

### macOS (sandbox-exec)

- Uses Apple's `sandbox-exec` which is technically deprecated
- Profile syntax is undocumented (reverse-engineered)
- May break in future macOS versions
- Some system calls may not be blockable

### Linux (Landlock)

- Requires kernel 5.13+ (Ubuntu 22.04+, Fedora 34+)
- Older kernels fall back to warning only (no protection)
- Some filesystems may not support Landlock
- Cannot restrict network access (use firewall for that)

## Security Recommendations

### For Users

1. **Keep secrets directory permissions tight**
   ```bash
   chmod 700 ~/.config/clawproxy/secrets
   chmod 600 ~/.config/clawproxy/secrets/*
   ```

2. **Use dedicated API keys** with minimal permissions

3. **Monitor API usage** through provider dashboards

4. **Keep software updated** for security patches

5. **Don't run agents as root**

### For Developers

1. Never log actual secret values
2. Use constant-time comparison for tokens
3. Clear sensitive data from memory when done
4. Validate all user input

## Responsible Disclosure

If you discover a security vulnerability:

1. **Do not** open a public issue
2. Email security@[your-domain].com
3. Include steps to reproduce
4. Allow 90 days for fix before public disclosure

We will:
- Acknowledge receipt within 48 hours
- Provide an initial assessment within 7 days
- Work with you on coordinated disclosure

## Security Updates

Subscribe to security announcements:
- GitHub Security Advisories
- Mailing list (if applicable)

## Audit Status

- [ ] No formal security audit conducted yet
- [ ] Community review welcome
```

## Research Questions to Answer

1. What are the exact capabilities of sandbox-exec?
2. What Landlock ABI features are we using?
3. Are there any known bypasses for our sandbox approach?
4. What's the attack surface of the proxy itself?

## Hints

- Be honest about limitations
- Don't oversell security properties
- Provide actionable recommendations
- Keep updated as new issues are found
